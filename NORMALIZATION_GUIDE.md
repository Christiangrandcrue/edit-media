# üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ - –ì–û–¢–û–í–û

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
**–§–∞–π–ª**: `/home/synthnova/backend/src/services/normalize-shot.js`

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**:
```javascript
{
  width: 1080,
  height: 1920,
  fps: 30,
  video_codec: 'libx264',
  video_crf: 23,
  audio_codec: 'aac',
  audio_bitrate: '128k',
  audio_samplerate: 48000
}
```

**–§—É–Ω–∫—Ü–∏–∏**:
- `normalizeVideo(inputPath, outputPath)` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ
- `processShotWithNormalization(file, type, tags)` - –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î

### 2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ shot-service.js
**–§–∞–π–ª**: `/home/synthnova/backend/src/services/shot-service.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `import { normalizeVideo, STANDARD_FORMAT } from './normalize-shot.js'`
- –ó–∞–º–µ–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `processShotUpload()` –Ω–∞ –≤–µ—Ä—Å–∏—é —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

### 3. –ü—Ä–æ—Ü–µ—Å—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:

**–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —à–æ—Ç–∞**:
1. ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ–º –ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç (MOV, MP4, MKV, ...)
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ 1080x1920, 30 FPS, H264
3. ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞—É–¥–∏–æ –≤ AAC, 128k, 48kHz
4. ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º padding –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º aspect ratio)
5. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å —Ñ–ª–∞–≥–æ–º `normalized: true` –∏ `original_filename`

**FFmpeg –∫–æ–º–∞–Ω–¥–∞**:
```bash
ffmpeg -i input.mov \
  -vf "scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2,setsar=1,fps=30" \
  -c:v libx264 -preset fast -crf 23 \
  -c:a aac -b:a 128k -ar 48000 \
  -movflags +faststart \
  output.mp4
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

### ‚úÖ –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- ‚ùå **–†–∞–∑–Ω—ã–µ FPS** (24/25/30/60/240) ‚Üí ‚úÖ **–í—Å–µ–≥–¥–∞ 30 FPS**
- ‚ùå **–†–∞–∑–Ω—ã–µ –∫–æ–¥–µ–∫–∏** (H264/HEVC) ‚Üí ‚úÖ **–í—Å–µ–≥–¥–∞ H264**
- ‚ùå **–†–∞–∑–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è** (320x240, 1080x1920) ‚Üí ‚úÖ **–í—Å–µ–≥–¥–∞ 1080x1920**
- ‚ùå **–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ** ‚Üí ‚úÖ **–í—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**
- ‚ùå **FFmpeg –æ—à–∏–±–∫–∏ 187, 254** ‚Üí ‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ —Å–∫–ª–µ–π–∫–∏**

### üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (CRF 23 –≤–º–µ—Å—Ç–æ —Ä–∞–∑–Ω—ã—Ö bitrate)
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–∫–ª–µ–π–∫–∏ (–∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ –≤—Å–µ–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ (H264 + AAC)
- –õ–æ–≥–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üìù –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### –ó–∞–≥—Ä—É–∑–∫–∞ —à–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ UI:
1. –û—Ç–∫—Ä—ã—Ç—å https://edit.synthnova.me
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –ª—é–±–æ–µ –≤–∏–¥–µ–æ (MOV, MP4, ...) —á–µ—Ä–µ–∑ Admin Panel
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `/data/shots/{type}/{type}_{timestamp}.mp4`

### –õ–æ–≥–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
```bash
pm2 logs synthnova-backend | grep Normalize
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞**:
```
[Normalize] Processing my_video.MOV -> hook_1768720000000.mp4
[Normalize] Normalizing to 1080x1920 @ 30 FPS
[Normalize] ‚úÖ Normalized: 1080x1920 @ 30 FPS, 5.32 MB
```

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. **–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —à–æ—Ç—ã** —á–µ—Ä–µ–∑ UI
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é** –≤ –ª–æ–≥–∞—Ö
3. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ** —Å –Ω–æ–≤—ã–º–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ —à–æ—Ç–∞–º–∏
4. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—à–∏–±–æ–∫ —Å–∫–ª–µ–π–∫–∏**

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —à–æ—Ç–æ–≤:
```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –Ω–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —á–µ—Ä–µ–∑ UI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
```

## üìÇ –§–∞–π–ª—ã:

- `/home/synthnova/backend/src/services/normalize-shot.js` - –º–æ–¥—É–ª—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- `/home/synthnova/backend/src/services/shot-service.js` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫
- –ë—ç–∫–∞–ø—ã:
  - `/home/synthnova/backend/src/services/shot-service.js.backup`
  - `/home/synthnova/backend/src/services/shot-service.js.before_normalize`

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —à–æ—Ç—ã (–ª—é–±–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞)
2. –û–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫ FFmpeg

**–î–∞—Ç–∞**: 2026-01-18  
**–í—Ä–µ–º—è**: ~5-10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ
