
    <!DOCTYPE html>
    <html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–í–∏–¥–µ–æ-–£–Ω–∏–∫–∞–ª–∏–∑–∞—Ç–æ—Ä | Synthnova</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
          body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
          }
          .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
          }
          .stat-card { transition: all 0.3s ease; }
          .stat-card:hover { box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
          
          /* Ensure modal is always on top - CRITICAL FIX */
          #uploadModal { 
            z-index: 2147483647 !important; /* Max 32-bit integer */
            position: fixed !important;
            isolation: isolate !important;
          }
          #uploadModal > div { 
            z-index: 2147483647 !important; 
            position: relative !important;
          }
          #uploadModal * { 
            position: relative !important;
            z-index: 1 !important;
          }
          
          /* Isolate main container to prevent stacking context issues */
          .max-w-6xl { isolation: isolate; }
        </style>
    </head>
    <body class="p-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="glass rounded-2xl p-8 mb-8 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h1 class="text-4xl font-bold mb-2">
                            <i class="fas fa-film mr-3"></i>
                            –í–∏–¥–µ–æ-–£–Ω–∏–∫–∞–ª–∏–∑–∞—Ç–æ—Ä
                        </h1>
                        <p class="text-xl opacity-90">–ú–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–æ–ª–∏–∫–æ–≤ –¥–ª—è TikTok</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm opacity-75">–°–µ—Ä–≤–µ—Ä</div>
                        <div class="text-2xl font-mono">185.178.46.187</div>
                        <div id="serverStatus" class="text-sm text-yellow-300">
                            <i class="fas fa-circle text-xs"></i> –ü—Ä–æ–≤–µ—Ä–∫–∞...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="glass rounded-xl p-6 text-white stat-card">
                    <div class="text-4xl mb-2"><i class="fas fa-server"></i></div>
                    <div class="text-sm opacity-75">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</div>
                    <div class="text-2xl font-bold">4 CPU / 8GB</div>
                </div>
                
                <div class="glass rounded-xl p-6 text-white stat-card">
                    <div class="text-4xl mb-2"><i class="fas fa-palette"></i></div>
                    <div class="text-sm opacity-75">FFmpeg —Ñ–∏–ª—å—Ç—Ä–æ–≤</div>
                    <div class="text-2xl font-bold">60+</div>
                </div>
                
                <div class="glass rounded-xl p-6 text-white stat-card">
                    <div class="text-4xl mb-2"><i class="fas fa-infinity"></i></div>
                    <div class="text-sm opacity-75">–ö–æ–º–±–∏–Ω–∞—Ü–∏–π</div>
                    <div class="text-2xl font-bold">35+ —Ç—Ä–ª–Ω</div>
                </div>
                
                <div class="glass rounded-xl p-6 text-white stat-card">
                    <div class="text-4xl mb-2"><i class="fas fa-clock"></i></div>
                    <div class="text-sm opacity-75">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                    <div class="text-2xl font-bold">~30 —Å–µ–∫/–≤–∏–¥–µ–æ</div>
                </div>
            </div>

            <!-- Generator Form -->
            <div class="glass rounded-2xl p-8 mb-8 text-white">
                <h2 class="text-2xl font-bold mb-6">
                    <i class="fas fa-rocket mr-2"></i>
                    –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
                </h2>
                
                <form id="generateForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–æ–ª–∏–∫–æ–≤</label>
                        <input 
                            type="number" 
                            id="numVideos"
                            min="1" 
                            max="1000" 
                            value="10"
                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50"
                            placeholder="–û—Ç 1 –¥–æ 1000"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">–ü—Ä–æ—Ñ–∏–ª—å —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏</label>
                        <select 
                            id="profile"
                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/50"
                        >
                            <option value="conservative" class="bg-gray-800">Conservative (—Ç–æ–ª—å–∫–æ color)</option>
                            <option value="moderate" selected class="bg-gray-800">Moderate (color + texture + temporal)</option>
                            <option value="aggressive" class="bg-gray-800">Aggressive (–≤—Å–µ —É—Ä–æ–≤–Ω–∏ + geo)</option>
                        </select>
                    </div>
                    
                    <div class="bg-white/10 rounded-lg p-4">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle mr-3 mt-1"></i>
                            <div class="text-sm opacity-90">
                                <strong>–†–∞—Å—á—ë—Ç–Ω–æ–µ –≤—Ä–µ–º—è:</strong> <span id="estimatedTime">5 –º–∏–Ω—É—Ç</span><br>
                                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ~<span id="estimatedCost">0.25</span> ‚ÇΩ
                            </div>
                        </div>
                    </div>
                    
                    <button 
                        type="submit"
                        id="submitBtn"
                        class="w-full bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold py-4 px-6 rounded-lg hover:from-green-500 hover:to-blue-600 transition-all duration-300 transform hover:scale-105"
                    >
                        <i class="fas fa-play mr-2"></i>
                        –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
                    </button>
                </form>
                
                <div id="result" class="mt-6 hidden"></div>
                
                <!-- Live Progress Panel -->
                <div id="liveProgressPanel" class="mt-6 hidden">
                    <h3 class="text-lg font-bold mb-4">
                        <i class="fas fa-broadcast-tower mr-2 text-green-400"></i>
                        Live Progress
                    </h3>
                    <div id="liveProgress" class="space-y-3"></div>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="glass rounded-2xl p-8 mb-8 text-white">
                <h2 class="text-2xl font-bold mb-6">
                    <i class="fas fa-upload mr-2"></i>
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö –≤–∏–¥–µ–æ
                </h2>
                
                <p class="text-sm opacity-75 mb-6">
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –≤–∏–¥–µ–æ-—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (—à–æ—Ç—ã) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–æ–ª–∏–∫–æ–≤.
                    –°–∏—Å—Ç–µ–º–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç Hook + Mid + CTA –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white/10 rounded-xl p-4 border-2 border-dashed border-white/30 hover:border-white/50 transition cursor-pointer" onclick="openUpload('hook')">
                        <div class="text-3xl mb-2">üé£</div>
                        <div class="font-bold">Hook</div>
                        <div class="text-sm opacity-75">–ù–∞—á–∞–ª–æ —Ä–æ–ª–∏–∫–∞ (3-5 —Å–µ–∫)</div>
                        <div class="text-xs opacity-50 mt-2">–ü—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ</div>
                    </div>
                    
                    <div class="bg-white/10 rounded-xl p-4 border-2 border-dashed border-white/30 hover:border-white/50 transition cursor-pointer" onclick="openUpload('mid')">
                        <div class="text-3xl mb-2">üé¨</div>
                        <div class="font-bold">Mid</div>
                        <div class="text-sm opacity-75">–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (5-15 —Å–µ–∫)</div>
                        <div class="text-xs opacity-50 mt-2">–ì–ª–∞–≤–Ω–∞—è —á–∞—Å—Ç—å</div>
                    </div>
                    
                    <div class="bg-white/10 rounded-xl p-4 border-2 border-dashed border-white/30 hover:border-white/50 transition cursor-pointer" onclick="openUpload('cta')">
                        <div class="text-3xl mb-2">üì¢</div>
                        <div class="font-bold">CTA</div>
                        <div class="text-sm opacity-75">Call-to-action (3-5 —Å–µ–∫)</div>
                        <div class="text-xs opacity-50 mt-2">–§–∏–Ω–∞–ª –∏ –ø—Ä–∏–∑—ã–≤</div>
                    </div>
                </div>
                
                
                <!-- Shots Stats -->
                <div id="shotsStats" class="grid grid-cols-3 gap-4 mt-6">
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold" id="hookCount">-</div>
                        <div class="text-xs opacity-75">Hook</div>
                    </div>
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold" id="midCount">-</div>
                        <div class="text-xs opacity-75">Mid</div>
                    </div>
                    <div class="bg-white/5 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold" id="ctaCount">-</div>
                        <div class="text-xs opacity-75">CTA</div>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <a href="/admin" class="text-sm opacity-75 hover:opacity-100 underline">
                        <i class="fas fa-cog mr-1"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–æ—Ç–∞–º–∏ –≤ Admin Panel
                    </a>
                </div>
            </div>

            <!-- Features -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass rounded-xl p-6 text-white">
                    <div class="text-3xl mb-3"><i class="fas fa-shield-alt"></i></div>
                    <h3 class="text-xl font-bold mb-2">Anti-Fraud</h3>
                    <p class="opacity-90">4 —É—Ä–æ–≤–Ω—è —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±–º–∞–Ω—ã–≤–∞—é—Ç –ø–µ—Ä—Ü–µ–ø—Ç–∏–≤–Ω—ã–π —Ö—ç—à TikTok</p>
                </div>
                
                <div class="glass rounded-xl p-6 text-white">
                    <div class="text-3xl mb-3"><i class="fas fa-tachometer-alt"></i></div>
                    <h3 class="text-xl font-bold mb-2">–ë—ã—Å—Ç—Ä–æ</h3>
                    <p class="opacity-90">15000 —Ä–æ–ª–∏–∫–æ–≤ –∑–∞ 60 —á–∞—Å–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–º —Å–µ—Ä–≤–µ—Ä–µ</p>
                </div>
                
                <div class="glass rounded-xl p-6 text-white">
                    <div class="text-3xl mb-3"><i class="fas fa-chart-line"></i></div>
                    <h3 class="text-xl font-bold mb-2">–≠–∫–æ–Ω–æ–º–∏—á–Ω–æ</h3>
                    <p class="opacity-90">1900 ‚ÇΩ/–º–µ—Å vs $1500-7500 –∑–∞ 15k —É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-8 text-white opacity-75">
                <p>¬© 2026 Synthnova | Timeweb Cloud VPS | FFmpeg 6.1.1 + Node.js 18.19.1</p>
                <a href="/admin" class="text-xs opacity-50 hover:opacity-100 mt-2 inline-block">
                    <i class="fas fa-cog mr-1"></i> Admin Panel
                </a>
            </div>
        </div>
                <!-- Upload Modal -->
                <div id="uploadModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999] p-4">
                    <div class="bg-gray-900 text-white rounded-2xl p-8 max-w-lg w-full shadow-2xl relative z-[10000]">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">–ó–∞–≥—Ä—É–∑–∏—Ç—å <span id="uploadTypeLabel">Mid</span></h3>
                            <button onclick="closeUpload()" class="text-2xl opacity-50 hover:opacity-100">√ó</button>
                        </div>
                        
                        <form id="uploadForm" class="space-y-4">
                            <input type="hidden" id="uploadType" value="mid">
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">–¢–µ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                <input 
                                    type="text" 
                                    id="uploadTags"
                                    placeholder="product, demo, promo"
                                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                <p class="text-xs opacity-50 mt-1">–ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</p>
                            </div>
                            
                            <div 
                                id="dropZone"
                                class="border-2 border-dashed border-white/30 rounded-xl p-8 text-center hover:border-white/50 hover:bg-white/5 transition cursor-pointer"
                            >
                                <div class="text-4xl mb-3">üìÅ</div>
                                <div class="font-bold mb-1">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</div>
                                <div class="text-sm opacity-75">–∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                                <div class="text-xs opacity-50 mt-2">MP4, MOV, AVI ‚Ä¢ –¥–æ 500MB ‚Ä¢ –¥–æ 50 —Ñ–∞–π–ª–æ–≤</div>
                                <input type="file" id="fileInput" multiple accept="video/*" class="hidden">
                            </div>
                            
                            <div id="fileList" class="space-y-2 max-h-40 overflow-y-auto"></div>
                            
                            <div id="uploadProgress" class="hidden">
                                <div class="flex justify-between mb-1">
                                    <span>–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                    <span id="uploadPercent">0%</span>
                                </div>
                                <div class="bg-white/10 rounded-full h-2">
                                    <div id="uploadBar" class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full transition-all" style="width:0%"></div>
                                </div>
                            </div>
                            
                            <button 
                                type="submit"
                                id="uploadBtn"
                                disabled
                                class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <i class="fas fa-cloud-upload-alt mr-2"></i>
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å
                            </button>
                        </form>
                        
                        <div id="uploadResult" class="mt-4 hidden"></div>
                    </div>
                </div>
        
        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
        <script>
          // Check server status
          async function checkStatus() {
            const statusEl = document.getElementById('serverStatus');
            try {
              const response = await axios.get('/api/status', { timeout: 5000 });
              const data = response.data;
              
              if (data.status === 'online') {
                statusEl.innerHTML = '<i class="fas fa-circle text-xs text-green-400"></i> Online';
                statusEl.className = 'text-sm text-green-300';
              } else {
                statusEl.innerHTML = '<i class="fas fa-circle text-xs text-red-400"></i> Offline';
                statusEl.className = 'text-sm text-red-300';
              }
            } catch (error) {
              statusEl.innerHTML = '<i class="fas fa-circle text-xs text-red-400"></i> Offline';
              statusEl.className = 'text-sm text-red-300';
            }
          }
          
          checkStatus();
          setInterval(checkStatus, 30000);

          // Update estimated time
          const numVideosInput = document.getElementById('numVideos');
          const estimatedTimeEl = document.getElementById('estimatedTime');
          const estimatedCostEl = document.getElementById('estimatedCost');
          
          function updateEstimates() {
            const numVideos = parseInt(numVideosInput.value) || 10;
            const minutes = Math.ceil(numVideos * 30 / 60);
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            
            let timeStr = '';
            if (hours > 0) timeStr += hours + ' —á ';
            if (mins > 0 || hours === 0) timeStr += mins + ' –º–∏–Ω';
            
            estimatedTimeEl.textContent = timeStr;
            estimatedCostEl.textContent = (numVideos * 0.025).toFixed(2);
          }
          
          numVideosInput.addEventListener('input', updateEstimates);
          updateEstimates();
          
          // Handle form submission
          document.getElementById('generateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const numVideos = parseInt(document.getElementById('numVideos').value);
            const profile = document.getElementById('profile').value;
            const resultEl = document.getElementById('result');
            const submitBtn = document.getElementById('submitBtn');
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            resultEl.className = 'mt-6 bg-blue-500/20 border border-blue-400/50 rounded-lg p-4';
            resultEl.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏...';
            resultEl.classList.remove('hidden');
            
            try {
              const response = await axios.post('/api/jobs', {
                num_videos: numVideos,
                profile: profile
              });
              
              const data = response.data;
              
              resultEl.className = 'mt-6 bg-green-500/20 border border-green-400/50 rounded-lg p-4';
              resultEl.innerHTML = `
                <div class="flex items-start">
                  <i class="fas fa-check-circle text-2xl mr-3 text-green-400"></i>
                  <div>
                    <div class="font-bold text-lg mb-2">–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞!</div>
                    <div class="space-y-1 text-sm opacity-90">
                      <div><strong>Job ID:</strong> ${data.job_id}</div>
                      <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.status}</div>
                      <div><strong>–†–æ–ª–∏–∫–æ–≤:</strong> ${data.num_videos}</div>
                      <div><strong>–ü—Ä–æ—Ñ–∏–ª—å:</strong> ${data.profile}</div>
                      <div><strong>–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è:</strong> ${data.estimated_time} –º–∏–Ω</div>
                      ${data.queue_position ? '<div><strong>–ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏:</strong> #' + data.queue_position + '</div>' : ''}
                    </div>
                    <div class="mt-4">
                      <a href="/api/jobs/${data.job_id}" target="_blank" 
                         class="text-sm underline hover:no-underline">
                        –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å ‚Üí
                      </a>
                    </div>
                  </div>
                </div>
              `;
              
              // Subscribe to WebSocket updates for this job
              subscribeToJob(data.job_id);
            } catch (error) {
              const errData = error.response?.data;
              
              resultEl.className = 'mt-6 bg-red-500/20 border border-red-400/50 rounded-lg p-4';
              
              if (errData?.fallback) {
                resultEl.className = 'mt-6 bg-yellow-500/20 border border-yellow-400/50 rounded-lg p-4';
                resultEl.innerHTML = `
                  <div class="flex items-start">
                    <i class="fas fa-exclamation-triangle text-2xl mr-3 text-yellow-400"></i>
                    <div>
                      <div class="font-bold text-lg mb-2">–°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>
                      <div class="text-sm opacity-90">${errData.message}</div>
                      <div class="text-xs mt-2 opacity-75">Job ID: ${errData.job_id}</div>
                    </div>
                  </div>
                `;
              } else {
                resultEl.innerHTML = `
                  <div class="flex items-start">
                    <i class="fas fa-exclamation-circle text-2xl mr-3 text-red-400"></i>
                    <div>
                      <div class="font-bold text-lg mb-2">–û—à–∏–±–∫–∞</div>
                      <div class="text-sm opacity-90">${errData?.error || error.message}</div>
                    </div>
                  </div>
                `;
              }
            } finally {
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<i class="fas fa-play mr-2"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é';
            }
          });
          
          // ============================================
          // HTTP POLLING FOR LIVE PROGRESS (HTTPS-safe)
          // ============================================
          
          let currentJobId = null;
          let pollingInterval = null;
          let lastJobStatus = null;
          
          async function pollJobStatus() {
            if (!currentJobId) return;
            
            try {
              const response = await axios.get(`/api/jobs/${currentJobId}`);
              const data = response.data;
              
              // Check if status changed
              if (JSON.stringify(data) !== lastJobStatus) {
                lastJobStatus = JSON.stringify(data);
                handleJobUpdate(data);
              }
            } catch (error) {
              console.error('[Polling] Error:', error);
            }
          }
          
          function startPolling(jobId) {
            currentJobId = jobId;
            lastJobStatus = null;
            
            // Poll every 2 seconds
            if (pollingInterval) clearInterval(pollingInterval);
            pollingInterval = setInterval(pollJobStatus, 2000);
            
            // Initial poll
            pollJobStatus();
          }
          
          function stopPolling() {
            if (pollingInterval) {
              clearInterval(pollingInterval);
              pollingInterval = null;
            }
            currentJobId = null;
          }
          
          function handleJobUpdate(data) {
            const panel = document.getElementById('liveProgressPanel');
            const progress = document.getElementById('liveProgress');
            
            // Show panel for active jobs
            if (data.status !== 'pending') {
              panel.classList.remove('hidden');
            }
            
            // Update based on status
            if (data.status === 'processing') {
              const percent = data.progress?.percent || 0;
              const completed = data.progress?.videos_completed || 0;
              const total = data.num_videos || 0;
              
              progress.innerHTML = `
                <div class="bg-blue-500/20 rounded-lg p-4">
                  <div class="flex justify-between mb-2">
                    <span><i class="fas fa-cog fa-spin mr-2"></i>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...</span>
                    <span class="font-bold">${percent}%</span>
                  </div>
                  <div class="bg-white/10 rounded-full h-3 mb-2">
                    <div class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-300" 
                         style="width:${percent}%"></div>
                  </div>
                  <div class="text-sm opacity-75">
                    –í–∏–¥–µ–æ: ${completed} / ${total}
                  </div>
                </div>
              `;
            } else if (data.status === 'completed') {
              stopPolling();
              progress.innerHTML = `
                <div class="bg-green-500/20 rounded-lg p-4">
                  <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-400 mr-3 text-2xl"></i>
                    <div class="flex-1">
                      <div class="font-bold text-green-400">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</div>
                      <div class="text-sm opacity-75">${data.successful || data.num_videos} –≤–∏–¥–µ–æ –≥–æ—Ç–æ–≤—ã</div>
                    </div>
                  </div>
                </div>
              `;
            } else if (data.status === 'failed') {
              stopPolling();
              progress.innerHTML = `
                <div class="bg-red-500/20 rounded-lg p-4">
                  <div class="flex items-center">
                    <i class="fas fa-exclamation-circle text-red-400 mr-3 text-2xl"></i>
                    <div>
                      <div class="font-bold text-red-400">–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>
                      <div class="text-sm opacity-75">${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>
                    </div>
                  </div>
                </div>
              `;
            }
          }
          
          // Subscribe to job after creation
          function subscribeToJob(jobId) {
            startPolling(jobId);
          }
          
          // ============================================
          // UPLOAD FUNCTIONALITY
          // ============================================
          
          let selectedFiles = [];
          
          function openUpload(type) {
            document.getElementById('uploadType').value = type;
            document.getElementById('uploadTypeLabel').textContent = type.charAt(0).toUpperCase() + type.slice(1);
            document.getElementById('uploadModal').classList.remove('hidden');
            selectedFiles = [];
            updateFileList();
          }
          
          function closeUpload() {
            document.getElementById('uploadModal').classList.add('hidden');
            document.getElementById('uploadResult').classList.add('hidden');
            document.getElementById('uploadProgress').classList.add('hidden');
          }
          
          // Close modal on escape or outside click
          document.getElementById('uploadModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('uploadModal')) closeUpload();
          });
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeUpload();
          });
          
          // Drag and drop
          const dropZone = document.getElementById('dropZone');
          const fileInput = document.getElementById('fileInput');
          
          dropZone.addEventListener('click', () => fileInput.click());
          
          dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-500', 'bg-blue-500/10');
          });
          
          dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-blue-500', 'bg-blue-500/10');
          });
          
          dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-500/10');
            handleFiles(e.dataTransfer.files);
          });
          
          fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
          });
          
          function handleFiles(files) {
            for (const file of files) {
              if (file.type.startsWith('video/') && selectedFiles.length < 50) {
                selectedFiles.push(file);
              }
            }
            updateFileList();
          }
          
          function updateFileList() {
            const fileList = document.getElementById('fileList');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (selectedFiles.length === 0) {
              fileList.innerHTML = '';
              uploadBtn.disabled = true;
              return;
            }
            
            fileList.innerHTML = selectedFiles.map((file, i) => 
              '<div class="flex items-center justify-between bg-white/5 rounded-lg px-3 py-2 text-sm text-white">' +
                '<span class="truncate flex-1 text-white">' + file.name + '</span>' +
                '<span class="opacity-50 mx-2 text-white">' + (file.size / 1024 / 1024).toFixed(1) + ' MB</span>' +
                '<button type="button" onclick="removeFile(' + i + ')" class="text-red-400 hover:text-red-300">' +
                  '<i class="fas fa-times"></i>' +
                '</button>' +
              '</div>'
            ).join('');
            
            uploadBtn.disabled = false;
            uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt mr-2"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å ' + selectedFiles.length + ' —Ñ–∞–π–ª(–æ–≤)';
          }
          
          function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
          }
          
          // Upload form submit
          document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (selectedFiles.length === 0) return;
            
            const type = document.getElementById('uploadType').value;
            const tags = document.getElementById('uploadTags').value;
            const uploadBtn = document.getElementById('uploadBtn');
            const uploadProgress = document.getElementById('uploadProgress');
            const uploadBar = document.getElementById('uploadBar');
            const uploadPercent = document.getElementById('uploadPercent');
            const uploadResult = document.getElementById('uploadResult');
            
            uploadBtn.disabled = true;
            uploadProgress.classList.remove('hidden');
            uploadResult.classList.add('hidden');
            
            const formData = new FormData();
            formData.append('type', type);
            if (tags) formData.append('tags', tags);
            selectedFiles.forEach(file => formData.append('files', file));
            
            try {
              const response = await axios.post('/api/shots/upload', formData, {
                onUploadProgress: (progressEvent) => {
                  const percent = Math.round((progressEvent.loaded * 100) / progressEvent.total);
                  uploadBar.style.width = percent + '%';
                  uploadPercent.textContent = percent + '%';
                }
              });
              
              const data = response.data;
              
              uploadResult.classList.remove('hidden');
              uploadResult.className = 'mt-4 bg-green-500/20 border border-green-400/50 rounded-lg p-4';
              uploadResult.innerHTML = 
                '<div class="flex items-center">' +
                  '<i class="fas fa-check-circle text-green-400 text-xl mr-3"></i>' +
                  '<div>' +
                    '<div class="font-bold">–ó–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!</div>' +
                    '<div class="text-sm opacity-75">' + (data.uploaded?.length || data.shots?.length || selectedFiles.length) + ' —Ñ–∞–π–ª–æ–≤</div>' +
                  '</div>' +
                '</div>';
              
              selectedFiles = [];
              updateFileList();
              loadShotsStats();
              
              // Auto-close after success
              setTimeout(closeUpload, 2000);
              
            } catch (error) {
              uploadResult.classList.remove('hidden');
              uploadResult.className = 'mt-4 bg-red-500/20 border border-red-400/50 rounded-lg p-4';
              uploadResult.innerHTML = 
                '<div class="flex items-center">' +
                  '<i class="fas fa-exclamation-circle text-red-400 text-xl mr-3"></i>' +
                  '<div>' +
                    '<div class="font-bold">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>' +
                    '<div class="text-sm opacity-75">' + (error.response?.data?.error || error.message) + '</div>' +
                  '</div>' +
                '</div>';
            } finally {
              uploadBtn.disabled = false;
              uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt mr-2"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å';
              uploadProgress.classList.add('hidden');
            }
          });
          
          // Load shots stats
          async function loadShotsStats() {
            try {
              const response = await axios.get('/api/shots/stats');
              const data = response.data;
              const stats = data.stats || data; // Handle both formats
              
              document.getElementById('hookCount').textContent = stats.hook || 0;
              document.getElementById('midCount').textContent = stats.mid || 0;
              document.getElementById('ctaCount').textContent = stats.cta || 0;
            } catch (error) {
              console.log('Stats unavailable');
            }
          }
          
          loadShotsStats();
        </script>
    </body>
    </html>
  